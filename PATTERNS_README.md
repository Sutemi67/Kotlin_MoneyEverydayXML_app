# Система пользовательских шаблонов для парсинга уведомлений

## Обзор

В приложении Money Everyday реализована новая система парсинга уведомлений, основанная на пользовательских шаблонах. Это позволяет пользователям создавать собственные правила для отслеживания финансовых транзакций из уведомлений различных банков и приложений.

## Основные изменения

### 1. Новый фрагмент "Шаблоны"
- Добавлен третий фрагмент в приложении
- Показывает список пользовательских шаблонов
- Отображает заглушку, если шаблонов нет
- FAB для добавления новых шаблонов

### 2. Пользовательские шаблоны
- Каждый шаблон содержит ключевые слова (через запятую)
- Описание шаблона для удобства
- Тип транзакции (доход/расход)
- Все шаблоны по умолчанию активны

### 3. Новый парсер уведомлений
- `CustomNotificationParser` заменяет старый `NotificationParser`
- Использует простой поиск по ключевым словам
- Автоматическое извлечение суммы из текста
- Более точное определение транзакций
- Меньше ложных срабатываний

## Как использовать

### Добавление шаблона
1. Откройте вкладку "Шаблоны"
2. Нажмите FAB (+)
3. Введите описание шаблона
4. Введите ключевые слова через запятую
5. Выберите тип транзакции (доход/расход)
6. Нажмите "Добавить"

### Примеры шаблонов

#### Сбербанк
```
Описание: Зачисление в Сбербанке
Ключевые слова: зачислен, сбербанк
Тип: Доход
```

#### Тинькофф
```
Описание: Покупка в Тинькофф
Ключевые слова: покупка, тинькофф
Тип: Расход
```

#### Выплата купона
```
Описание: Выплата купона по облигациям
Ключевые слова: выплата, купон
Тип: Доход
```

#### Общий шаблон для рублей
```
Описание: Любая сумма в рублях
Ключевые слова: ₽, руб
Тип: Доход
```

### Управление шаблонами
- **Активация/деактивация**: Используйте переключатель в каждом шаблоне
- **Удаление**: Нажмите на кнопку удаления (X) в правом верхнем углу карточки
- **Редактирование**: Пока не реализовано (планируется в будущих версиях)

## Техническая реализация

### База данных
- Новая таблица `notification_patterns`
- Версия базы данных увеличена до 7
- DAO для работы с шаблонами

### Архитектура
- MVVM с использованием Koin для DI
- Room для хранения данных
- Flow для реактивного обновления UI

### Компоненты
- `PatternsFragment` - основной фрагмент
- `PatternsViewModel` - ViewModel
- `PatternsAdapter` - адаптер для списка
- `AddPatternDialogFragment` - диалог добавления
- `CustomNotificationParser` - новый парсер

## Преимущества нового подхода

1. **Простота**: Пользователь вводит только ключевые слова, не нужно знать регулярные выражения
2. **Точность**: Пользователь сам определяет, какие уведомления отслеживать
3. **Гибкость**: Можно создать шаблоны для любых банков и приложений
4. **Автоматическое извлечение**: Сумма извлекается автоматически из любого места в тексте
5. **Меньше ошибок**: Нет ложных срабатываний на нефинансовые уведомления
6. **Персонализация**: Каждый пользователь может настроить под свои нужды

## Миграция

При первом запуске новой версии:
- Старые транзакции сохраняются
- Парсер автоматически переключается на пользовательские шаблоны
- Если шаблонов нет, парсинг не работает (нужно добавить шаблоны)

## Планы развития

1. **Предустановленные шаблоны**: Добавить популярные шаблоны по умолчанию
2. **Редактирование**: Возможность редактирования существующих шаблонов
3. **Импорт/экспорт**: Обмен шаблонами между пользователями
4. **Тестирование**: Возможность протестировать шаблон на примере текста
5. **Группировка**: Организация шаблонов по категориям 