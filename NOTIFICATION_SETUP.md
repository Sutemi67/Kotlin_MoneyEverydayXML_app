# Настройка автоматического добавления транзакций через уведомления

## Описание функциональности

Приложение поддерживает автоматическое добавление транзакций из любых уведомлений, содержащих финансовую информацию. Система анализирует все входящие уведомления на предмет наличия сумм денег и финансовых ключевых слов, что позволяет автоматически добавлять транзакции независимо от источника уведомления.

## Универсальный подход

В отличие от привязки к конкретным банкам, система работает по принципу:
1. **Анализ всех уведомлений** - система проверяет каждое входящее уведомление
2. **Поиск финансовых ключевых слов** - ищет слова типа "зачислено", "списано", "платеж", "пополнение"
3. **Извлечение сумм** - находит денежные суммы в различных форматах
4. **Автоматическое добавление** - сохраняет транзакцию в базу данных

## Поддерживаемые источники

Система работает с уведомлениями от любых приложений, включая:
- Банковские приложения (Сбербанк, ВТБ, Тинькофф, и др.)
- Платежные системы (ЮMoney, PayPal, и др.)
- Электронные кошельки
- Приложения доставки еды
- Онлайн-магазины
- Любые другие приложения с финансовыми уведомлениями

## Настройка разрешений

### 1. Включение доступа к уведомлениям

1. При первом запуске приложения появится уведомление с предложением включить доступ к уведомлениям
2. Нажмите "Настроить" в уведомлении
3. В настройках Android найдите раздел "Уведомления" → "Доступ к уведомлениям"
4. Найдите приложение "Money Everyday" и включите переключатель
5. Подтвердите разрешение

### 2. Альтернативный способ настройки

Если уведомление не появилось:
1. Откройте Настройки Android
2. Перейдите в "Приложения" → "Money Everyday" → "Разрешения"
3. Включите "Доступ к уведомлениям"

## Как это работает

1. **Мониторинг уведомлений**: Сервис постоянно отслеживает все входящие уведомления
2. **Фильтрация**: Проверяет каждое уведомление на наличие финансовой информации
3. **Анализ**: Извлекает из текста уведомления:
   - Сумму транзакции
   - Описание операции
   - Тип транзакции (доход/расход)
4. **Автоматическое добавление**: Транзакция автоматически сохраняется в базу данных
5. **Уведомление пользователя**: Показывается Snackbar с информацией о добавленной транзакции

## Поддерживаемые форматы сумм

Сервис распознает суммы в следующих форматах:
- 1 000 ₽
- 1,000 руб
- 1000 рублей
- 1 000 RUB
- 1 000 р
- 1 000 $ (USD)
- 1 000 € (EUR)
- Простые числа (если есть финансовые ключевые слова)

## Финансовые ключевые слова

Система распознает следующие ключевые слова для определения финансовых транзакций:

### Доходы:
- зачислен, зачисление, пополнение, входящий, получен, начислен
- поступил, поступление, начисление, пополнен, зачислено
- income, received, credited, deposit, transfer received

### Расходы:
- списан, списание, платеж, перевод, оплата, покупка, расход
- списано, платеж, оплачено, потрачено, израсходовано
- expense, payment, purchase, transfer sent, withdrawal

### Общие финансовые термины:
- баланс, счет, карта, банк, банковский, финанс
- операция, транзакция, деньги, средства, валюта
- balance, account, card, bank, financial, transaction

## Определение типа транзакции

Система автоматически определяет, является ли транзакция доходом или расходом на основе ключевых слов в уведомлении. Если больше слов, связанных с расходами - транзакция считается расходом (отрицательная сумма).

## Безопасность и конфиденциальность

- Приложение обрабатывает уведомления только локально на устройстве
- Данные не передаются на внешние серверы
- Доступ к уведомлениям можно отключить в любой момент
- Все транзакции сохраняются в локальной базе данных
- Анализируются только уведомления с финансовой информацией

## Ограничения

1. **Требуется разрешение**: Пользователь должен явно разрешить доступ к уведомлениям
2. **Зависимость от формата**: Качество распознавания зависит от формата уведомлений
3. **Только уведомления**: Транзакции добавляются только при получении push-уведомлений
4. **Ложные срабатывания**: Возможны ложные срабатывания на нефинансовые уведомления с числами

## Устранение неполадок

### Транзакции не добавляются автоматически
1. Проверьте, включен ли доступ к уведомлениям
2. Убедитесь, что приложение отправляет push-уведомления
3. Проверьте, содержит ли уведомление сумму и финансовые ключевые слова
4. Проверьте логи приложения на наличие ошибок

### Неправильное распознавание сумм
1. Проверьте формат уведомлений
2. Убедитесь, что сумма указана в поддерживаемом формате
3. При необходимости добавьте новые паттерны в код

### Ложные срабатывания
1. Система может реагировать на нефинансовые уведомления с числами
2. Проверьте логи для понимания, какие уведомления обрабатываются
3. При необходимости настройте фильтры

### Приложение не получает уведомления
1. Перезапустите приложение
2. Проверьте настройки батареи (некоторые устройства ограничивают фоновую работу)
3. Добавьте приложение в список исключений оптимизации батареи

## Техническая информация

- Используется `NotificationListenerService` API
- Парсинг реализован с помощью регулярных выражений
- Универсальный анализ без привязки к конкретным приложениям
- Интеграция с существующей базой данных через Repository
- Обновление UI через BroadcastReceiver 